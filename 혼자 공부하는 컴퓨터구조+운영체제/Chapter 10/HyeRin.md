

## Chapter 10: 프로세스와 스레드

### 10-1 : 프로세스 개요
#### 프로세스

- 프로세스
    - 실행중인 프로그램을 말함.
    - 포그라운드 프로세스: 사용자가 보는 앞에서 실행되는 프로세스
    - 백그라운드 프로세스: 사용자가 보지 못하는 뒷편에서 실행되는 프로세스
    - 데몬(유닉스) / 윈도우(서비스): 사용자와 상호작용하지 않는 백그라운드 프로세스
 <br>
- 프로세스 제어블록(PCB)
    - 한정된 CPU로, 프로세스들은 정해진 시간만큼만 차례대로 CUP를 사용, 이러한 실행순서를 관리하고 자원배분을 위해 운영체제는 프로세스 제어블록을 이용
<br>
- 프로세스ID
    - 프로세스를 식별하기 위해 부여하는 고유한 번호
<br>
- 레지스터 값
    - 프로세스는 자신의 실행차례가 오면 이전까지 사용한 레지스터의 중간값을 모두 복원하여 진행했던 작업들을 이어서 실행.
    - PCB 안에는 해당 프로세스가 실행하며 사용했던 프로그램 카운터를 비롯한 레지스터 값 담김
<br>
- 프로세스 상태
    - 프로세스 상태가 PCB에 저장 
    - 현재 프로세스가 입출력장치 사용을 위해 대기하고 있는지,,cpu사용을 대기하고 있는지..
<br>
- CPU 스케줄링 정보
    - 프로세스가 언제, 어떤 순서로 CPU 할당받을지에 대한 정보 기록
<br>
- 메모리 관리 정보
    - 프로세스마다 메모리에 저장되는 위치가 다름 -> PCB에는 프로세스가 어느 주소에 저장되어있는지 정보 담겨야.
    - 베이스 레지스터, 한계 레지스터 값, 페이지 테이블 정보등도 PCB에 담김
<br>
- 사용한 파일과 입출력장치 목록 
    - 프로세스 실행과정에서 사용되는 입출력장치나 파일 목록 또한 PCB에 저장된다.

#### 문맥교환
-   문맥교환
    - 문맥: 기존 수행하던 프로세스를 재개하기 위해 기억해야하는 정보
    - 문맥교환: 기존 프로세스 문맥을 PCB에 백업하고, 새로운 실행하려는 프로세스의 문맥을 복원하는 것

#### 프로세스 메모리 영역
1. 정적 할당 영역 - 코드영역과 데이터 영역은 크기가 고정되어있음
 
- 코드영역
    - 텍스트 영역이라고도 함
    - 기계어로 이루어진 명령어가 저장됨 -> 실행할 명령어가 담겨있기에 쓰기가 금지 READ ONLY 공간
- 데이터 영역
    - 프로그램이 실행되는 동안 유지되는 데이터가 저장되는 공간 EX) 전역변수

2. 동적 할당 영역 - 프로세스 실행과정에서 크기가 변할 수 있는 영역
- 힙 영역
    - 프로그래머가 직접 할당할 수 있는 저장공간 => 한번 할당하면 언젠가는 반환해야 함.
    - 메모리 누수 : 메모리 공간을 반환하지 않는다면 메모리 낭비 초래 
    - 메모리의 낮은 주소에서 높은 주소로 할당
- 스택 영역
    - 데이터를 일시적으로 저장하는 공간
    - EX) 지역변수, 매개변수 <> 전역변수 (데이터 영역)
    - 높은주소에서 낮은 주소로 할당


### 10-1 : 프로세스 상태와 계층구조
#### 프로세스 상태
프로세스가 가질 수 있는 대표적인 상태는 다음과 같다.
- 생성상태
    - 프로세스가 생성되고 메모리에 적재됨
    - PCB를 할당받은 상태 (아직 CPU할당 기다리는 상태)
- 준비상태
    - CPU를 할당받기 기다림
- 실행상태
    - CPU를 할당받아 실행 중.
    - 프로세스가 할당된 시간을 모두 사용 => 준비상태 
    - 입출력장치의 사용을 위해 대기필요 => 대기 상태
- 대기상태
    - 입출력장치의 작업을 기다리는 상태
    - 입출력 작업이 완료되면 다시 준비상태로 CPU할당 대기
    - 입출력 작업이 필요한 프로세스는 입출력장치가 작업을 끝낼때까지 기다려야함 (입출력장치의 작업속도가 CPU 보다 느리기 때문)
- 종료상태 
    - 프로세스가 종료된 상태
    - 운영체제는 PCB와 프로세스가 사용한 메모리 정리

#### 프로세스 계층 구조
- 부모프로세스
    - 새 프로세스를 생성하는 프로세스
    - 프로페스는 실행 도중, 새로운 프로세스를 생성할 수 있다. 이럴 때, 새 프로세스를 생성하는 프로세스를 말함. 
    - 부모프로세스와 자식은 다른 프로세스로, 각기 다른 PID를 가진다.
- 자식프로세스
    - 부모에 의해 생성된 프로세스

이렇듯 프로세스는 마치 피라미드와 같이, 계층적인 구조를 가지고 있음.

#### 프로세스 생성 기법
부모에 의해 생성된 자식 프로세스들은 복제와 옷 갈아입기를 통해 실행된다.
- fork : 부모 프로세스는 fork를 통해 자신의 복사본을 자식으로 생성하는 시스템 호출 
- exec: 자식 프로세스는 exec를 통해 자신의 메모리 공간을 다른 프로그램으로 교체
    - 부모가 복사해서 만들어진 후에, exec 시스템 호출을 통해 새로운 프로그램으로 전환된다. 즉, 새로운 프로그램 내용으로 전환하여 실행하는 시스템 호출.
- 따라서, 프로세스의 계층적인 구조는 반복되는 fork와 exec를 통해 실행된다 (부모는 본인을 복사하고, 자식은 옷갈아 입기 방식)

